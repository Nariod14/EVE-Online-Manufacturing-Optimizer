(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2522:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eJ});var s=a(5155),l=a(6671),r=a(2115),n=a(9708),i=a(2085),o=a(2596),c=a(9688);function d(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,c.QP)((0,o.$)(t))}let u=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function m(e){let{className:t,variant:a,size:l,asChild:r=!1,...i}=e,o=r?n.DX:"button";return(0,s.jsx)(o,{"data-slot":"button",className:d(u({variant:a,size:l,className:t})),...i})}let x=!1,b=new Promise(e=>{if(x||"undefined"!=typeof globalThis&&!0===globalThis.__MSW_READY__){x=!0,e();return}Object.defineProperty(globalThis,"__MSW_READY__",{set:t=>{!0===t&&(x=!0,e())},configurable:!0})});function h(){let[e,t]=(0,r.useState)(),[a,l]=(0,r.useState)(!1),[n,i]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=async()=>{i(!0);try{let e=new AbortController,a=setTimeout(()=>e.abort(),5e3),s=await fetch("/auth/status",{credentials:"include",signal:e.signal});if(clearTimeout(a),!s.ok)throw Error("HTTP error ".concat(s.status));let l=await s.json();console.log("FETCHED LOGIN STATUS:",l),l.logged_in?t(l.character_name):t(void 0)}catch(e){console.error("auth status fetch failed or timed out",e),t(void 0)}finally{i(!1)}};e();let a=async()=>{await e()};return window.addEventListener("focus",a),()=>{window.removeEventListener("focus",a)}},[]);let o=async()=>{l(!0),localStorage.setItem("isLoggedIn","true"),window.location.href="/login"},c=async()=>{console.log("\uD83D\uDC4B handleLogout started");try{console.log("\uD83D\uDCE1 sending POST /logout...");let e=await fetch("/logout",{method:"POST",credentials:"include"});e.ok?(console.log("✅ Logged out successfully"),t(void 0)):console.error("❌ Logout failed",await e.text())}catch(e){console.error("⚠️ Error during logout",e)}};return(0,s.jsxs)("div",{className:"flex flex-col items-center my-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6 text-blue-300",children:"EVE Online Manufacturing Optimizer"}),n?(0,s.jsx)("div",{className:"text-blue-200 animate-pulse",children:"Checking login status..."}):e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"my-4 font-bold text-blue-200",children:["Welcome, ",e,"!"]}),e&&(0,s.jsx)(m,{onClick:()=>{console.log("logout clicked"),c()},variant:"secondary",className:"px-4 py-2 text-blue-100 bg-blue-800 hover:bg-blue-700",children:"Logout"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m,{className:d("bg-gradient-to-r from-blue-900 via-blue-700 to-blue-500 text-white shadow-lg","hover:from-blue-800 hover:to-blue-600 transition-all duration-200"),disabled:a,onClick:o,size:"lg",children:a?"Logging in...":"Log in with EVE Online"}),(0,s.jsx)("div",{className:"mt-4 font-semibold text-blue-200",children:a&&"Redirecting to EVE SSO..."})]})]})}var p=a(5452),g=a(4416);function f(e){let{...t}=e;return(0,s.jsx)(p.bL,{"data-slot":"dialog",...t})}function j(e){let{...t}=e;return(0,s.jsx)(p.ZL,{"data-slot":"dialog-portal",...t})}function v(e){let{...t}=e;return(0,s.jsx)(p.bm,{"data-slot":"dialog-close",...t})}function N(e){let{className:t,...a}=e;return(0,s.jsx)(p.hJ,{"data-slot":"dialog-overlay",className:d("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function y(e){let{className:t,children:a,showCloseButton:l=!0,...r}=e;return(0,s.jsxs)(j,{"data-slot":"dialog-portal",children:[(0,s.jsx)(N,{}),(0,s.jsxs)(p.UC,{"data-slot":"dialog-content",className:d("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...r,children:[a,l&&(0,s.jsxs)(p.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,s.jsx)(g.A,{}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function w(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-header",className:d("flex flex-col gap-2 text-center sm:text-left",t),...a})}function _(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-footer",className:d("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function S(e){let{className:t,...a}=e;return(0,s.jsx)(p.hE,{"data-slot":"dialog-title",className:d("text-lg leading-none font-semibold",t),...a})}function C(e){let{className:t,...a}=e;return(0,s.jsx)(p.VY,{"data-slot":"dialog-description",className:d("text-muted-foreground text-sm",t),...a})}function k(e){let{className:t,type:a,...l}=e;return(0,s.jsx)("input",{type:a,"data-slot":"input",className:d("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...l})}var T=a(968);function F(e){let{className:t,...a}=e;return(0,s.jsx)(T.b,{"data-slot":"label",className:d("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}function M(e){let{open:t,onOpenChange:a,onStationAdded:l}=e,[n,i]=(0,r.useState)(""),[o,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(null),[x,b]=(0,r.useState)(!1),h=async e=>{e.preventDefault(),b(!0),u(null);try{let e=await fetch("/api/stations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n.trim(),station_id:parseInt(o,10)})}),t=await e.json();e.ok?(u({success:!0,message:"✅ Station added successfully!"}),i(""),c(""),l&&l()):u({success:!1,message:"❌ ".concat(t.error||"Unknown error")})}catch(e){u({success:!1,message:"❌ Network error"})}finally{b(!1)}},p=()=>{u(null),i(""),c(""),a(!1)};return(0,s.jsx)(f,{open:t,onOpenChange:p,children:(0,s.jsxs)(y,{className:"max-w-md bg-slate-900 text-blue-100 border border-blue-700",children:[(0,s.jsx)(w,{children:(0,s.jsx)(S,{className:"text-blue-300",children:"Add New Station"})}),(0,s.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{htmlFor:"stationName",className:"font-semibold text-blue-200",children:"Station Name"}),(0,s.jsx)(k,{id:"stationName",name:"stationName",placeholder:"e.g., Neo Nexus Refinery",value:n,onChange:e=>i(e.target.value),required:!0,className:"bg-slate-800 text-blue-100 border-blue-700 mt-1"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{htmlFor:"stationId",className:"font-semibold text-blue-200",children:"Station ID"}),(0,s.jsx)(k,{id:"stationId",name:"stationId",type:"number",placeholder:"e.g., 1024012922938",value:o,onChange:e=>c(e.target.value),required:!0,className:"bg-slate-800 text-blue-100 border-blue-700 mt-1"})]}),d&&(0,s.jsx)("div",{className:"mt-2 font-semibold ".concat(d.success?"text-green-400":"text-red-400"),children:d.message}),(0,s.jsxs)(_,{className:"gap-2",children:[(0,s.jsx)(m,{type:"submit",disabled:x,className:"bg-gradient-to-r from-blue-700 via-blue-900 to-blue-800 text-white font-bold",children:x?"Adding...":"Add Station"}),(0,s.jsx)(m,{type:"button",variant:"secondary",onClick:p,className:"bg-slate-700 text-blue-200 hover:bg-slate-600",children:"Close"})]})]})]})})}function O(e){let{open:t,onOpenChange:a,stations:l,loading:r,error:n,onEditStation:i,onDeleteStation:o}=e;return(0,s.jsx)(f,{open:t,onOpenChange:a,children:(0,s.jsxs)(y,{className:"max-w-lg bg-slate-900 text-blue-100 border border-blue-700",children:[(0,s.jsx)(w,{children:(0,s.jsx)(S,{className:"text-blue-300",children:"Stations"})}),(0,s.jsxs)("div",{className:"space-y-4 max-h-[50vh] overflow-y-auto",children:[r&&(0,s.jsx)("div",{children:"Loading stations..."}),n&&(0,s.jsx)("div",{className:"text-red-400",children:n}),!r&&!n&&0===l.length&&(0,s.jsx)("div",{className:"text-blue-400",children:"No stations added yet."}),!r&&!n&&l.length>0&&(0,s.jsxs)("table",{className:"w-full text-left border-separate border-spacing-y-2",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"pr-2",children:"Name"}),(0,s.jsx)("th",{className:"pr-2",children:"ID"}),(0,s.jsx)("th",{className:"pr-2",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:l.map(e=>(0,s.jsxs)("tr",{className:"bg-slate-800 rounded",children:[(0,s.jsx)("td",{className:"pr-2",children:e.name}),(0,s.jsx)("td",{className:"pr-2",children:e.station_id}),(0,s.jsxs)("td",{className:"flex gap-2",children:[(0,s.jsx)(m,{size:"sm",variant:"secondary",className:"bg-blue-700 text-white",onClick:()=>i(e),children:"Edit"}),o&&(0,s.jsx)(m,{size:"sm",variant:"destructive",onClick:()=>o(e.id),children:"Delete"})]})]},e.id))})]})]}),(0,s.jsx)(_,{children:(0,s.jsx)(m,{variant:"secondary",onClick:()=>a(!1),children:"Close"})})]})})}function I(e){let{open:t,onOpenChange:a,station:l,onStationUpdate:n}=e,[i,o]=(0,r.useState)(""),[c,d]=(0,r.useState)(""),[u,x]=(0,r.useState)(null),[b,h]=(0,r.useState)(!1);if((0,r.useEffect)(()=>{if(l)o(l.name),d(l.station_id.toString()),x(null);else{o(""),d(""),x(null);return}},[l,t]),!l)return null;let p=async e=>{if(e.preventDefault(),h(!0),x(null),!i.trim()||!c.trim()){x({success:!1,message:"Name and Station ID cannot be empty"}),h(!1);return}try{let e=await fetch("/api/stations/".concat(l.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i.trim(),station_id:parseInt(c,10)})});if(e.ok)x({success:!0,message:"✅ Station updated successfully!"}),n&&n({...l,name:i,station_id:parseInt(c,10)}),setTimeout(()=>a(!1),1500);else{let t=await e.json();x({success:!1,message:"❌ Error updating station: ".concat(t.error||"Unknown error")})}}catch(e){x({success:!1,message:"❌ Error updating station: ".concat(e instanceof Error?e.message:"Unknown error")})}finally{h(!1)}},g=()=>{x(null),a(!1)};return(0,s.jsx)(f,{open:t,onOpenChange:g,children:(0,s.jsxs)(y,{className:"max-w-md bg-slate-900 text-blue-100 border border-blue-700",children:[(0,s.jsx)(w,{children:(0,s.jsx)(S,{className:"text-blue-300",children:"Edit Station"})}),(0,s.jsxs)("form",{onSubmit:p,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{htmlFor:"editStationName",className:"font-semibold text-blue-200",children:"Name"}),(0,s.jsx)(k,{id:"editStationName",value:i,onChange:e=>o(e.target.value),required:!0,className:"bg-slate-800 text-blue-100 border-blue-700 mt-1"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{htmlFor:"editStationStationId",className:"font-semibold text-blue-200",children:"Station ID"}),(0,s.jsx)(k,{id:"editStationStationId",type:"number",value:c,onChange:e=>d(e.target.value),required:!0,className:"bg-slate-800 text-blue-100 border-blue-700 mt-1"})]}),u&&(0,s.jsx)("div",{className:"mt-2 font-semibold ".concat(u.success?"text-green-400":"text-red-400"),children:u.message}),(0,s.jsxs)(_,{className:"gap-2",children:[(0,s.jsx)(m,{type:"submit",disabled:b,className:"bg-gradient-to-r from-blue-700 via-blue-900 to-blue-800 text-white font-bold",children:b?"Saving...":"Save"}),(0,s.jsx)(m,{type:"button",variant:"secondary",onClick:g,className:"bg-slate-700 text-blue-200",children:"Cancel"})]})]})]})})}function P(e){let{stations:t,loading:a=!1,error:l=null,onEdit:r,onDelete:n}=e;return a?(0,s.jsx)("div",{className:"text-blue-200 p-6 text-center",children:"Loading stations..."}):l?(0,s.jsx)("div",{className:"text-red-400 p-6 text-center",children:l}):t.length?(0,s.jsxs)("table",{className:"w-full text-left border-separate border-spacing-y-2",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"pr-2 py-2 text-blue-400",children:"Name"}),(0,s.jsx)("th",{className:"pr-2 py-2 text-blue-400",children:"ID"}),(0,s.jsx)("th",{className:"pr-2 py-2 text-blue-400 text-center",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:t.map(e=>(0,s.jsxs)("tr",{className:"bg-slate-800/80 hover:bg-blue-900/50 transition rounded-xl",children:[(0,s.jsx)("td",{className:"pr-2 py-2 rounded-l-xl font-semibold text-blue-100",children:e.name}),(0,s.jsx)("td",{className:"pr-2 py-2 text-blue-300",children:e.station_id}),(0,s.jsxs)("td",{className:"pr-2 py-2 rounded-r-xl flex gap-2 justify-center",children:[r&&(0,s.jsx)(m,{size:"sm",variant:"secondary",className:"bg-blue-700 text-white hover:bg-blue-800 transition",onClick:()=>r(e),children:"Edit"}),n&&(0,s.jsx)(m,{size:"sm",variant:"destructive",className:"hover:bg-red-700 transition",onClick:()=>n(e.id),children:"Delete"})]})]},e.id))})]}):(0,s.jsx)("div",{className:"text-blue-400 p-6 text-center",children:"No stations added yet."})}function E(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card",className:d("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function A(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-header",className:d("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function z(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-title",className:d("leading-none font-semibold",t),...a})}function R(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-description",className:d("text-muted-foreground text-sm",t),...a})}function L(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-content",className:d("px-6",t),...a})}var B=a(3478),D=a(6474);function U(e){let{...t}=e;return(0,s.jsx)(B.bL,{"data-slot":"accordion",...t})}function q(e){let{className:t,...a}=e;return(0,s.jsx)(B.q7,{"data-slot":"accordion-item",className:d("border-b last:border-b-0",t),...a})}function V(e){let{className:t,children:a,...l}=e;return(0,s.jsx)(B.Y9,{className:"flex",children:(0,s.jsxs)(B.l9,{"data-slot":"accordion-trigger",className:d("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",t),...l,children:[a,(0,s.jsx)(D.A,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function J(e){let{className:t,children:a,...l}=e;return(0,s.jsx)(B.UC,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...l,children:(0,s.jsx)("div",{className:d("pt-0 pb-4",t),children:a})})}function K(){let[e,t]=(0,r.useState)(!1),[a,l]=(0,r.useState)(!1),[n,i]=(0,r.useState)(!1),[o,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(!0),[x,b]=(0,r.useState)(null),[h,p]=(0,r.useState)(null),[g,f]=(0,r.useState)(!1);async function j(){u(!0),console.log("MSW ready. Requesting /api/stations");try{let e=await fetch("/api/stations");if(!e.ok)throw Error("HTTP ".concat(e.status));let t=await e.json();c(t)}catch(e){console.error("Failed to fetch stations:",e)}finally{u(!1)}}(0,r.useEffect)(()=>{j()},[]);let v=e=>{p(e),i(!0)},N=async e=>{try{let t=await fetch("/api/stations/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,station_id:e.station_id})});if(!t.ok)throw Error("Failed to update station, status ".concat(t.status));await j()}catch(e){console.error("Error updating station:",e)}},y=async e=>{if(window.confirm("Are you sure you want to delete this station?"))try{let t=await fetch("/api/stations/".concat(e),{method:"DELETE"});if(t.ok)c(t=>t.filter(t=>t.id!==e));else{let e=await t.json();alert("Error: "+(e.error||"Unknown error"))}}catch(e){alert("Error: "+(e instanceof Error?e.message:"Unknown error"))}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(E,{className:"h-full rounded-2xl bg-gradient-to-br from-slate-900 via-slate-950 to-blue-950 border-blue-800 shadow-2xl w-full",children:[(0,s.jsx)(A,{className:"px-6 pb-2",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(z,{className:"text-2xl text-blue-100",children:"Your Stations"}),(0,s.jsx)(R,{className:"text-blue-400",children:"Manage your selling stations. (If none, Jita will be used)"})]}),(0,s.jsx)(m,{onClick:()=>t(!0),className:"bg-gradient-to-r from-blue-700 via-blue-900 to-blue-800 text-white hover:from-blue-800 hover:to-blue-900 scale-120 relative right-2",children:"+ Add Station"})]})}),(0,s.jsx)(L,{className:"px-6 pb-6",children:(0,s.jsx)(U,{type:"single",collapsible:!0,children:(0,s.jsxs)(q,{value:"stations",className:"border-none bg-slate-900/60 rounded-xl overflow-hidden",children:[(0,s.jsx)(V,{className:"text-blue-200 text-lg font-bold tracking-wide rounded-xl px-4 py-3 bg-blue-900/80 hover:bg-blue-800/80 hover:no-underline shadow transition-all",children:"View Station List"}),(0,s.jsx)(J,{className:"bg-slate-900/80 px-2 pb-4 pt-2 rounded-b-xl",children:(0,s.jsx)(P,{stations:o,loading:d,error:x,onEdit:v,onDelete:y})})]})})})]}),(0,s.jsx)(O,{open:a,onOpenChange:l,stations:o,loading:d,error:x,onEditStation:v}),h&&(0,s.jsx)(I,{open:n,onOpenChange:i,station:h,onStationUpdate:N}),(0,s.jsx)(M,{open:e,onOpenChange:t})]})}var W=a(7863),Q=a(9917),Y=a(2525),H=a(133);function Z(e){return e>=1e9?(e/1e9).toFixed(2)+"b":e>=1e6?(e/1e6).toFixed(2)+"m":e>=1e3?(e/1e3).toFixed(2)+"k":e.toString()}function $(e){let{onDelete:t,children:a}=e,[l,n]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(!l)return;let e=setTimeout(()=>n(!1),3e3);return()=>clearTimeout(e)},[l]),(0,s.jsx)(m,{size:"sm",variant:"destructive",onClick:()=>{l?(t(),n(!1)):n(!0)},className:"transition-colors ".concat(l?"bg-red-700 hover:bg-red-900":"bg-red-600 hover:bg-red-800"),children:l?"Confirm Delete?":a})}function G(e){return e.toLocaleString()+" ISK"}function X(e){let{materials:t}=e;if(!t||0===t.length)return(0,s.jsx)("div",{className:"text-gray-400 italic",children:"No materials"});let a=t.reduce((e,t)=>{if(!t)return e;let a=t.category||"Other";return e[a]||(e[a]={}),e[a][t.name]=t.quantity,e},{});return(0,s.jsx)("ul",{className:"list-none pl-0 m-0 text-xs",children:Object.entries(a).map(e=>{let[t,a]=e;return(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-semibold",children:t}),(0,s.jsx)("ul",{className:"list-none pl-3",children:Object.entries(a).map(e=>{let[t,a]=e;return(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"text-accent",children:t}),":"," ","number"==typeof a?a.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2}):a]},t)})})]},t)})})}function ee(e){let{blueprints:t,onEdit:a,onSetBlueprints:n,loading:i,fetchBlueprints:o}=e,[c,d]=(0,r.useState)({}),[u,x]=(0,r.useState)({}),[b,h]=(0,r.useState)({key:"name",direction:"asc"}),[p,g]=(0,r.useState)({key:"name",direction:"asc"}),[f,j]=(0,r.useState)("");function v(e){return"T2"===e.tier}let[N,y]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(window.__msw)y(!0);else{let e=setInterval(()=>{window.__msw&&(clearInterval(e),y(!0))},50)}},[]);let w=async e=>{(await fetch("/api/blueprints/blueprint/".concat(e),{method:"DELETE"})).ok?(l.oR.success("Blueprint deleted"),null==o||o()):l.oR.error("Failed to delete blueprint")},_=async e=>{if(!n)return;console.log("Resetting max value for blueprint",e);let t=await fetch("/api/blueprints/blueprint/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({max:null})});t.ok?(n(t=>t.map(t=>t.id===e?{...t,max:null}:t)),d(t=>{let a={...t};return delete a[e],a}),console.log("Toast triggered for individual reset"),l.oR.success("Blueprint max value reset")):(console.error("Failed to reset max value: "+t.statusText),l.oR.error("Failed to reset max value"))},S=async e=>{if(!n)return;x(t=>({...t,[e]:!0})),console.log("Resetting all max values for tier",e);let t=await fetch("/api/blueprints/blueprints/reset_max",{method:"POST"});t.ok?(console.log("All max values reset"),l.oR.success("All max values reset"),n(e=>e.map(e=>({...e,max:null}))),d({})):(console.error("Failed to reset all max values"+t.statusText),l.oR.error("Failed to reset all max values")),x(t=>({...t,[e]:!1}))},C=(e,t)=>{d(a=>({...a,[e]:t}))},T=async e=>{let t=c[e];if(""===t||null==t)return;let a=parseInt(t,10);isNaN(a)||((await fetch("/api/blueprints/blueprint/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({max:a})})).ok?l.oR.success("Max value updated"):l.oR.error("Failed to update max value"))};function F(e,t){return[...e].sort((e,a)=>{var s,l,r,n;let i="asc"===t.direction?1:-1;switch(t.key){case"name":return e.name.localeCompare(a.name)*i;case"sell_price":return(e.sell_price-a.sell_price)*i;case"material_cost":return(e.material_cost-a.material_cost)*i;case"full_material_cost":return(("T2"===e.tier?e.full_material_cost:e.material_cost)-("T2"===a.tier?a.full_material_cost:a.material_cost))*i;case"profit":return(e.sell_price-("T2"===e.tier?e.full_material_cost:e.material_cost)-(a.sell_price-("T2"===a.tier?a.full_material_cost:a.material_cost)))*i;case"profit_percent":{let t="T2"===e.tier?e.full_material_cost:e.material_cost,s="T2"===a.tier?a.full_material_cost:a.material_cost;return((t>0?(e.sell_price-t)/t*100:0)-(s>0?(a.sell_price-s)/s*100:0))*i}case"station_name":return((null==(s=e.station)?void 0:s.name)||e.station_name||"Jita 4-4").localeCompare((null==(l=a.station)?void 0:l.name)||a.station_name||"Jita 4-4")*i;case"max":return((null!=(r=e.max)?r:0)-(null!=(n=a.max)?n:0))*i;case"invention_chance":return(("T2"===e.tier?e.invention_chance:0)-("T2"===a.tier?a.invention_chance:0))*i;default:return 0}})}function M(e,t){let a=t.trim().toLowerCase();return a?e.filter(e=>{var t,s,l;let r=e.sell_price,n=e.material_cost,i=r-n,o=n>0?(i/n*100).toFixed(2):"-",c=(null==(t=e.name)?void 0:t.toLowerCase().includes(a))||(null==(s=e.station_name)?void 0:s.toLowerCase().includes(a))||String(r).includes(a)||String(n).includes(a)||String(i).includes(a)||o.includes(a)||String(null!=(l=e.max)?l:"").includes(a),d=!!Array.isArray(e.materials)&&e.materials.some(e=>{var t;return(null==(t=e.name)?void 0:t.toLowerCase().includes(a))||String(e.quantity).includes(a)});if("T2"===e.tier){let t=r-e.full_material_cost,s=e.full_material_cost>0?(t/e.full_material_cost*100).toFixed(2):"-",l=String(e.full_material_cost).includes(a)||String(e.invention_chance).includes(a)||String(t).includes(a)||s.includes(a);return c||l||d}return c||d}):e}let O=t.filter(e=>"T1"===e.tier),I=t.filter(v),P=M(O,f),E=M(I,f);function A(e,t,a,l){return(0,s.jsx)("tr",{className:"T2"===a?"text-orange-400":"text-blue-400",children:e.map(e=>{let a=["name","sell_price","material_cost","full_material_cost","profit","profit_percent","station_name","max","invention_chance"].includes(e.key),r=t.key===e.key;return(0,s.jsx)("th",{className:"py-2 px-3 text-left ".concat(a?"cursor-pointer select-none hover:underline":""),onClick:()=>a&&l({key:e.key,direction:r&&"asc"===t.direction?"desc":"asc"}),children:(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[e.label,a&&r?"asc"===t.direction?(0,s.jsx)(D.A,{className:"w-4 h-4 inline"}):(0,s.jsx)(W.A,{className:"w-4 h-4 inline"}):null]})},e.key)})})}return(0,s.jsxs)(L,{children:[(0,s.jsx)(R,{children:(0,s.jsx)("div",{className:"mb-4 flex justify-between items-center gap-4",children:(0,s.jsx)(k,{type:"text",placeholder:"Search blueprints...",value:f,onChange:e=>j(e.target.value),className:"w-full max-w-md bg-blue-900 text-blue-200 border-blue-700"})})}),(0,s.jsxs)(U,{type:"multiple",className:"mb-4",children:[(0,s.jsxs)(q,{value:"t1",defaultChecked:!0,children:[(0,s.jsx)(V,{className:"text-lg font-semibold text-blue-100 bg-gradient-to-r from-blue-800 via-blue-700 to-blue-900 hover:no-underline rounded-t-xl rounded-b-none px-4 py-3",style:{borderBottom:"2px solid #60a5fa",boxShadow:"0 2px 8px 0 #2563eb22"},children:(0,s.jsx)("span",{className:"text-blue-200",children:"Tier 1 Blueprints"})}),(0,s.jsx)(J,{className:"bg-gradient-to-br from-blue-950 via-blue- to-slate-950 hover:no-underline rounded-b-xl px-2 pb-4 pt-2",children:P.length?(0,s.jsxs)("div",{className:"overflow-x-auto",children:[(0,s.jsxs)("table",{className:"min-w-full text-sm bg-blue-950/70 rounded-xl shadow",children:[(0,s.jsx)("thead",{children:A([{key:"name",label:"Name"},{key:"sell_price",label:"Sell Price"},{key:"material_cost",label:"Material Cost"},{key:"materials",label:"Materials"},{key:"profit_percent",label:"Profit %"},{key:"station_name",label:"Station"},{key:"max",label:"Max"},{key:"actions",label:"Actions"}],b,"T1",h)}),(0,s.jsx)("tbody",{children:F(P,b).map(e=>{var t,l,r;let n=Math.round(e.sell_price),i=Math.round(e.material_cost),o=n-i,d=i>0?(o/i*100).toFixed(2):"-";return(0,s.jsxs)("tr",{className:"border-b border-blue-800 hover:bg-blue-900/60 text-blue-200 transition",children:[(0,s.jsx)("td",{className:"py-2 px-3 font-semibold",children:e.name}),(0,s.jsxs)("td",{className:"py-2 px-3",children:[G(n)," ",(0,s.jsxs)("span",{className:"text-xs text-blue-400 ml-1",children:["(",Z(n)," isk)"]}),e.used_jita_fallback&&(0,s.jsx)("span",{className:"ml-2 text-orange-400",title:"Fallback to Jita pricing",children:"⚠"})]}),(0,s.jsxs)("td",{className:"py-2 px-3",children:[G(i)," ",(0,s.jsxs)("span",{className:"text-xs text-blue-400 ml-1",children:["(",Z(i)," isk)"]})]}),(0,s.jsx)("td",{className:"py-2 px-3",children:(0,s.jsx)(X,{materials:e.materials})}),(0,s.jsxs)("td",{className:"py-2 px-3 text-center",children:[d,"%"]}),(0,s.jsx)("td",{className:"py-2 px-3 text-center",children:e.station_name||(null==(t=e.station)?void 0:t.name)||"Jita 4-4"}),(0,s.jsx)("td",{className:"py-2 px-3 text-center",children:(0,s.jsx)(k,{type:"number",value:null!=(r=c[e.id])?r:null!=(l=e.max)?l:"",onChange:t=>C(e.id,t.target.value),onBlur:()=>T(e.id),className:"w-16 text-center bg-blue-900 border-blue-700"})}),(0,s.jsx)("td",{className:"py-2 px-3 text-center",children:(0,s.jsxs)("div",{className:"flex flex-col gap-2 items-stretch",children:[(0,s.jsxs)(m,{size:"sm",variant:"secondary",className:"bg-blue-700 text-white",onClick:()=>null==a?void 0:a(e,"T1"),children:[(0,s.jsx)(Q.A,{className:"w-4 h-4 mr-1"})," Edit"]}),(0,s.jsxs)($,{onDelete:()=>w(e.id),children:[(0,s.jsx)(Y.A,{className:"w-4 h-4 mr-1"})," Delete"]}),(0,s.jsxs)(m,{size:"sm",variant:"outline",className:"border-blue-500 text-blue-700 bg-blue-200",onClick:()=>_(e.id),children:[(0,s.jsx)(H.A,{className:"w-4 h-4 mr-1"})," Reset Max"]})]})})]},e.id)})})]}),(0,s.jsx)("div",{className:"flex justify-end mt-3",children:(0,s.jsxs)(m,{variant:"outline",className:"border-blue-500 text-blue-700 bg-blue-50",onClick:()=>S("T1"),disabled:!!u.T1,children:[(0,s.jsx)(H.A,{className:"w-4 h-4 mr-2"}),u.T1?"Resetting...":"Reset All Max Values"]})})]}):(0,s.jsx)("div",{className:"p-6 text-blue-400",children:"No Tier 1 blueprints found."})})]}),(0,s.jsxs)(q,{value:"t2",children:[(0,s.jsx)(V,{className:"text-lg font-semibold bg-gradient-to-r from-orange-400 via-orange-500 to-yellow-500 text-orange-900 hover:no-underline rounded-t-none px-4 py-3",style:{borderBottom:"2px solid #f59e42",boxShadow:"0 2px 8px 0 #f59e4222"},children:(0,s.jsx)("span",{className:"text-[#fcf2e2]",children:"Tier 2 Blueprints"})}),(0,s.jsx)(J,{className:"bg-[#2d1e13] rounded-b-xl px-2 pb-4 pt-2 border-l-[8px] border-[#ff9800] shadow-[0_4px_20px_0_rgba(200,120,30,0.13)]",children:E.length?(0,s.jsxs)("div",{className:"overflow-x-auto",children:[(0,s.jsxs)("table",{className:"min-w-full text-sm bg-[#2d1e13] rounded-xl shadow",children:[(0,s.jsx)("thead",{children:A([{key:"name",label:"Name"},{key:"invention_chance",label:"Invention Chance %"},{key:"sell_price",label:"Sell Price"},{key:"full_material_cost",label:"Full Material Cost"},{key:"materials",label:"Materials"},{key:"profit_percent",label:"Profit %"},{key:"station_name",label:"Station"},{key:"max",label:"Max"},{key:"actions",label:"Actions"}],p,"T2",g)}),(0,s.jsx)("tbody",{children:F(E,p).map(e=>{if(!v(e))return console.log("Blueprint ".concat(e.id," is not Tier 2!")),null;{var t,l,r,n;e.material_cost;let i=Math.round(e.sell_price),o=Math.round(null!=(l=e.full_material_cost)?l:e.material_cost),d=i-o,u=o>0?(d/o*100).toFixed(2):"-";return(0,s.jsxs)("tr",{className:"border-b border-[#ff9800] hover:bg-[#5a492f] text-amber-100 transition",children:[(0,s.jsx)("td",{className:"py-2 px-3 font-semibold text-[#e8d5b9]",children:e.name}),(0,s.jsx)("td",{className:"py-2 px-3 text-center text-[#fff1dc]",children:null!=e.invention_chance?(100*e.invention_chance).toFixed(1)+"%":"-"}),(0,s.jsxs)("td",{className:"py-2 px-3 text-[#ffedd1]",children:[G(i)," ",(0,s.jsxs)("span",{className:"text-xs text-[#d57d00] ml-1",children:["(",Z(i)," isk)"]}),e.used_jita_fallback&&(0,s.jsx)("span",{className:"ml-2 text-[#d57d00]",title:"Fallback to Jita pricing",children:"⚠"})]}),(0,s.jsxs)("td",{className:"py-2 px-3 text-[#ffedd1]",children:[G(o)," ",(0,s.jsxs)("span",{className:"text-xs text-[#d57d00] ml-1",children:["(",Z(o)," isk)"]})]}),(0,s.jsx)("td",{className:"py-2 px-3",children:(0,s.jsx)(X,{materials:e.materials})}),(0,s.jsxs)("td",{className:"py-2 px-3 text-center text-[#ffeed4]",children:[u,"%"]}),(0,s.jsx)("td",{className:"py-2 px-3 text-center text-[#ffedd1]",children:e.station_name||(null==(t=e.station)?void 0:t.name)||"Jita 4-4"}),(0,s.jsx)("td",{className:"py-2 px-3 text-center",children:(0,s.jsx)(k,{type:"number",value:null!=(n=c[e.id])?n:null!=(r=e.max)?r:"",onChange:t=>C(e.id,t.target.value),onBlur:()=>T(e.id),className:"w-16 text-center bg-[#3a2719] border-[#e08900] text-[##ffedd1]"})}),(0,s.jsx)("td",{className:"py-2 px-3 text-center",children:(0,s.jsxs)("div",{className:"flex flex-col gap-2 items-stretch",children:[(0,s.jsxs)(m,{size:"sm",variant:"secondary",className:"bg-[#e08900] text-white hover:bg-[#f09a00]",onClick:()=>null==a?void 0:a(e,"T2"),children:[(0,s.jsx)(Q.A,{className:"w-4 h-4 mr-1"})," Edit"]}),(0,s.jsxs)($,{onDelete:()=>w(e.id),children:[(0,s.jsx)(Y.A,{className:"w-4 h-4 mr-1"})," Delete"]}),(0,s.jsxs)(m,{size:"sm",variant:"outline",className:"border-[#e08900] text-[#bf7404] bg-amber-100",onClick:()=>_(e.id),children:[(0,s.jsx)(H.A,{className:"w-4 h-4 mr-1"})," Reset Max"]})]})})]},e.id)}})})]}),(0,s.jsx)("div",{className:"flex justify-end mt-3",children:(0,s.jsxs)(m,{variant:"outline",className:"border-[#e08900] text-[#ce7c00] bg-amber-50",onClick:()=>S("T2"),disabled:!!u.T2,children:[(0,s.jsx)(H.A,{className:"w-4 h-4 mr-2"}),u.T2?"Resetting...":"Reset All Max Values"]})})]}):(0,s.jsx)("div",{className:"p-6 text-[#d57d00]",children:"No Tier 2 blueprints found."})})]})]}),(0,s.jsxs)("div",{className:"price-legend mt-2 text-sm text-[#ff9500]",children:[(0,s.jsx)("span",{className:"text-orange-400",children:"⚠"})," Fallback to Jita pricing"]})]})}var et=a(1146),ea=a(5196);function es(e){let{...t}=e;return(0,s.jsx)(et.bL,{"data-slot":"select",...t})}function el(e){let{...t}=e;return(0,s.jsx)(et.WT,{"data-slot":"select-value",...t})}function er(e){let{className:t,size:a="default",children:l,...r}=e;return(0,s.jsxs)(et.l9,{"data-slot":"select-trigger","data-size":a,className:d("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...r,children:[l,(0,s.jsx)(et.In,{asChild:!0,children:(0,s.jsx)(D.A,{className:"size-4 opacity-50"})})]})}function en(e){let{className:t,children:a,position:l="popper",...r}=e;return(0,s.jsx)(et.ZL,{children:(0,s.jsxs)(et.UC,{"data-slot":"select-content",className:d("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:l,...r,children:[(0,s.jsx)(eo,{}),(0,s.jsx)(et.LM,{className:d("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,s.jsx)(ec,{})]})})}function ei(e){let{className:t,children:a,...l}=e;return(0,s.jsxs)(et.q7,{"data-slot":"select-item",className:d("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...l,children:[(0,s.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,s.jsx)(et.VF,{children:(0,s.jsx)(ea.A,{className:"size-4"})})}),(0,s.jsx)(et.p4,{children:a})]})}function eo(e){let{className:t,...a}=e;return(0,s.jsx)(et.PP,{"data-slot":"select-scroll-up-button",className:d("flex cursor-default items-center justify-center py-1",t),...a,children:(0,s.jsx)(W.A,{className:"size-4"})})}function ec(e){let{className:t,...a}=e;return(0,s.jsx)(et.wn,{"data-slot":"select-scroll-down-button",className:d("flex cursor-default items-center justify-center py-1",t),...a,children:(0,s.jsx)(D.A,{className:"size-4"})})}function ed(e){let{open:t,blueprint:a,tier:l,onClose:n,onSave:i}=e,[o,c]=r.useState(null),[d,u]=(0,r.useState)([]),[x,b]=(0,r.useState)(""),[h,p]=(0,r.useState)(!1),[g,j]=(0,r.useState)(1),[N,C]=(0,r.useState)(void 0),[T,M]=(0,r.useState)("");if((0,r.useEffect)(()=>{async function e(){try{let e=await fetch("/api/stations"),t=await e.json();u(t)}catch(e){console.error("Failed to fetch stations:",e)}}t&&e()},[t]),(0,r.useEffect)(()=>{a&&c(a)},[a]),!o)return null;function O(e){let{name:t,value:a}=e.target;c(e=>e?{...e,[t]:"sell_price"===t||"material_cost"===t?parseFloat(a):a}:e)}function I(e,t,a){c(s=>{if(!s)return null;let l=[...s.materials||[]];return l[e]={...l[e],[t]:a},{...s,materials:l}})}let P={T1:{modal:"rounded-2xl max-h-[90vh] overflow-y-auto bg-gradient-to-br from-slate-900 via-slate-950 to-blue-950 border border-blue-800 shadow-2xl text-white",label:"text-[#a0c4ff] mb-1",input:"bg-slate-800 border border-blue-800 text-white focus:ring-blue-400 focus:border-blue-400",dropdown:" border border-blue-800 text-blue-100 shadow-lg rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500",dropdownItem:"px-4 py-2 rounded-md text-blue-100 hover:bg-blue-800 hover:text-blue-200 focus:bg-blue-900 focus:text-white cursor-pointer transition-colors",selectValue:"bg-slate-800 border border-blue-800 text-white focus:ring-blue-400 focus:border-blue-400",selectTrigger:"bg-slate-800 border border-blue-800 text-white focus:ring-blue-400 focus:border-blue-400",selectContent:"bg-slate-900 text-white",buttonPrimary:"bg-blue-700 hover:bg-blue-500 focus:ring-blue-500 text-white",buttonSecondary:"bg-slate-900 text-blue-300 hover:bg-blue-700",title:"text-blue-300"},T2:{modal:"rounded-2xl max-h-[90vh] overflow-y-auto bg-gradient-to-br from-yellow-900 via-amber-900 to-orange-950 border border-amber-700 shadow-2xl text-[#f0e4c1]",label:"text-[#f9d58b] mb-1",input:"bg-[#5c3b0d] border border-amber-700 text-[#f0e4c1] focus:ring-amber-400 focus:border-amber-400",dropdown:"bg-[#4a2e08] via-amber-900 to-orange-950 border border-amber-700 text-[#f0e4c1] shadow-lg rounded-xl focus:ring-2 px-3 focus:ring-amber-400 focus:border-amber-400",dropdownItem:"px-4 py-2 rounded-md text-amber-100 hover:bg-amber-900 hover:text-amber-200 focus:bg-amber-950 focus:text-white cursor-pointer transition-colors",selectTrigger:"bg-[#5c3b0d] border border-amber-700 text-amber-100 focus:ring-amber-400 focus:border-amber-400 [&>[data-placeholder]]:text-amber-400",selectValue:"bg-[#5c3b0d] border border-amber-700 text-amber-100 focus:ring-amber-400 focus:border-amber-400",selectContent:"bg-[#3e2f0f] text-[#f0e4c1]",buttonPrimary:"bg-amber-700 hover:bg-amber-500 focus:ring-amber-500 text-[#0c0802]",buttonSecondary:"bg-[#3b2e08] text-amber-500 hover:bg-amber-900",title:"text-amber-400"}}[o.tier||"T1"];return(0,s.jsx)(f,{open:t,onOpenChange:e=>!e&&n(),children:(0,s.jsxs)(y,{className:"max-w-lg rounded-lg shadow-lg overflow-hidden ".concat(P.modal),children:[(0,s.jsx)(w,{children:(0,s.jsx)(S,{className:"text-2xl font-semibold ".concat(P.title),children:"Edit Blueprint"})}),(0,s.jsxs)("form",{onSubmit:function(e){e.preventDefault(),o&&function(e){for(let t of e.materials||[])if(!t.category||""===t.category.trim())return void alert("Please select or enter a category for material: ".concat(t.name||"Unnamed"));i(e)}(o)},className:"space-y-6 overflow-x-hidden",children:[(0,s.jsx)(k,{type:"hidden",name:"id",value:o.id}),(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{htmlFor:"editBlueprintName",className:P.label,children:"Blueprint Name"}),(0,s.jsx)(k,{id:"editBlueprintName",name:"name",value:o.name,onChange:O,required:!0,className:"".concat(P.input," w-full")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{htmlFor:"editBlueprintSellPrice",className:P.label,children:"Sell Price"}),(0,s.jsx)(k,{id:"editBlueprintSellPrice",name:"sell_price",type:"number",step:"0.01",value:o.sell_price,onChange:O,required:!0,className:"".concat(P.input," w-full")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{htmlFor:"editBlueprintCost",className:P.label,children:"Material Cost"}),(0,s.jsx)(k,{id:"editBlueprintCost",name:"material_cost",type:"number",step:"0.01",value:o.material_cost,onChange:O,required:!0,className:"".concat(P.input," w-full")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{htmlFor:"editBlueprintStation",className:P.label,children:"Manufacturing Station"}),(0,s.jsxs)("select",{id:"editBlueprintStation",name:"station_id",value:o.station_id||"",onChange:O,className:"".concat(P.input," w-full rounded-md py-2 px-1.5"),children:[(0,s.jsx)("option",{value:"",children:"None (Use Jita)"}),d.map(e=>(0,s.jsxs)("option",{value:e.station_id,children:[e.name," (",e.station_id,")"]},e.station_id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{htmlFor:"blueprintParseAmtPerRun",className:"".concat(P.label," mb-1 block"),children:"Amount per Run"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)(es,{value:h?"custom":String(null!=g?g:1),onValueChange:e=>{if("custom"===e)p(!0);else{let t=Number(e);p(!1),j(t),c(e=>e?{...e,amt_per_run:t}:e)}},children:[(0,s.jsx)(er,{id:"blueprintParseAmtPerRun",className:"".concat(P.selectTrigger," ").concat(P.dropdown," h-10 pl-4 mt-2 scale-110 mx-2 custom-select-trigger"),children:(0,s.jsx)(el,{})}),(0,s.jsxs)(en,{className:P.selectContent,children:[(0,s.jsx)(ei,{value:"100",children:"100 Units"}),(0,s.jsx)(ei,{value:"1",children:"1 Unit"}),(0,s.jsx)(ei,{value:"custom",children:"Custom…"})]})]}),h&&(0,s.jsx)("input",{type:"number",min:1,value:N,onChange:e=>{let t=Number(e.target.value);C(t),c(e=>e?{...e,amt_per_run:t}:e)},className:"".concat(P.input," w-full rounded-md py-2 px-1.5")})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{htmlFor:"editBlueprintTier",className:P.label,children:"Tier"}),(0,s.jsxs)(es,{value:o.tier,onValueChange:function(e){c(t=>{if(!t)return t;if("T2"===e)return"T1"===t.tier?{...t,tier:"T2",invention_chance:0,invention_cost:0,full_material_cost:t.material_cost,runs_per_copy:10}:t;if("T2"===t.tier){let{invention_chance:e,invention_cost:a,full_material_cost:s,runs_per_copy:l,...r}=t;return{...r,tier:"T1"}}return t})},children:[(0,s.jsx)(er,{id:"editBlueprintTier",className:"".concat(P.selectTrigger," max-w-50 scale-110 mx-2"),children:(0,s.jsx)(el,{})}),(0,s.jsxs)(en,{className:P.selectContent,children:[(0,s.jsx)(ei,{value:"T1",children:"Tier 1"}),(0,s.jsx)(ei,{value:"T2",children:"Tier 2"})]})]})]}),"T2"===o.tier&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{htmlFor:"editBlueprintInventionChance",className:P.label,children:"Invention Chance (%)"}),(0,s.jsx)(k,{id:"editBlueprintInventionChance",name:"invention_chance",type:"number",min:0,max:100,step:.1,value:o.invention_chance?100*o.invention_chance:"",onChange:function(e){let t=e.target.value;c(e=>e&&"T2"===e.tier?{...e,invention_chance:t?parseFloat(t)/100:0}:e)},className:"".concat(P.input," max-w-25")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{htmlFor:"editBlueprintRunsPerCopy",className:P.label,children:"Runs per Invented Copy"}),(0,s.jsxs)(es,{value:String(o.runs_per_copy||10),onValueChange:function(e){c(t=>t?{...t,runs_per_copy:parseInt(e,10)}:t)},children:[(0,s.jsx)(er,{id:"editBlueprintRunsPerCopy",className:"".concat(P.selectTrigger," max-w-50"),children:(0,s.jsx)(el,{})}),(0,s.jsxs)(en,{className:P.selectContent,children:[(0,s.jsx)(ei,{value:"10",children:"10 Runs"}),(0,s.jsx)(ei,{value:"1",children:"1 Run"})]})]})]})]}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Materials"}),(o.materials||[]).map((e,t)=>{var a;return(0,s.jsxs)("div",{className:"flex gap-2 items-center mb-2",children:[(0,s.jsx)(k,{type:"text",placeholder:"Name",value:e.name,onChange:e=>I(t,"name",e.target.value),className:"w-1/3"}),(0,s.jsx)(k,{type:"number",placeholder:"Qty",value:e.quantity,min:0,onChange:e=>I(t,"quantity",parseInt(e.target.value)||0),className:"w-1/4"}),(()=>{let a="Other"===e.category,l=e.category&&!["Minerals","Items","Components","Invention Materials","Reaction Materials","Planetary Materials","Other"].includes(e.category);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(es,{value:l?"Other":e.category||"",onValueChange:e=>{"Other"===e?I(t,"category","Other"):I(t,"category",e)},children:[(0,s.jsx)(er,{className:P.selectTrigger,children:(0,s.jsx)(el,{placeholder:"Select category",className:P.selectValue})}),(0,s.jsxs)(en,{className:P.selectContent,children:[(0,s.jsx)(ei,{value:"Minerals",className:P.dropdownItem,children:"Minerals"}),(0,s.jsx)(ei,{value:"Items",children:"Items"}),(0,s.jsx)(ei,{value:"Components",children:"Components"}),(0,s.jsx)(ei,{value:"Invention Materials",children:"Invention Materials"}),(0,s.jsx)(ei,{value:"Reaction Materials",children:"Reaction Materials"}),(0,s.jsx)(ei,{value:"Planetary Materials",children:"Planetary Materials"}),(0,s.jsx)(ei,{value:"Other",className:P.dropdownItem,children:"Other"})]})]}),(a||l)&&(0,s.jsx)(k,{type:"text",placeholder:"Enter custom category",value:e.category||"",onChange:e=>I(t,"category",e.target.value),className:P.selectTrigger})]})})(),(0,s.jsx)(m,{type:"button",variant:"destructive",onClick:()=>{c(e=>{if(!e)return null;let a=[...e.materials||[]];return a.splice(t,1),{...e,materials:a}})},className:"w-1/6",children:"Remove"})]},null!=(a=e.id)?a:t)}),(0,s.jsx)(m,{type:"button",onClick:function(){c(e=>e?{...e,materials:[...e.materials||[],{id:Date.now(),name:"",quantity:0}]}:null)},variant:"secondary",className:"mt-2",children:"+ Add Material"})]}),(0,s.jsxs)(_,{children:[(0,s.jsx)(m,{type:"submit",className:P.buttonPrimary,children:"Save Changes"}),(0,s.jsx)(v,{asChild:!0,children:(0,s.jsx)(m,{type:"button",variant:"secondary",className:P.buttonSecondary,children:"Cancel"})})]})]})]})})}function eu(e){let{className:t,...a}=e;return(0,s.jsx)("textarea",{"data-slot":"textarea",className:d("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}var em=a(7701),ex=a(9428);function eb(e){let{className:t,...a}=e;return(0,s.jsx)(em.bL,{"data-slot":"radio-group",className:d("grid gap-3",t),...a})}function eh(e){let{className:t,...a}=e;return(0,s.jsx)(em.q7,{"data-slot":"radio-group-item",className:d("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,s.jsx)(em.C1,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:(0,s.jsx)(ex.A,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}var ep=a(1243),eg=a(3453),ef=a(7655);function ej(e){let{className:t,children:a,...l}=e;return(0,s.jsxs)(ef.bL,{"data-slot":"scroll-area",className:d("relative",t),...l,children:[(0,s.jsx)(ef.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),(0,s.jsx)(ev,{}),(0,s.jsx)(ef.OK,{})]})}function ev(e){let{className:t,orientation:a="vertical",...l}=e;return(0,s.jsx)(ef.VM,{"data-slot":"scroll-area-scrollbar",orientation:a,className:d("flex touch-none p-px transition-colors select-none","vertical"===a&&"h-full w-2.5 border-l border-l-transparent","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent",t),...l,children:(0,s.jsx)(ef.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}let eN={T1:{modal:"rounded-2xl bg-gradient-to-br from-slate-900 via-slate-950 to-blue-950 border border-blue-800 shadow-2xl text-white",label:"text-blue-300",input:"bg-slate-800 border border-blue-700 text-blue-100 placeholder:text-blue-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",li:"text-blue-100",dropdown:" border border-blue-800 text-blue-100 shadow-lg rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500",dropdownItem:"px-4 py-2 rounded-md text-blue-100 hover:bg-blue-800 hover:text-blue-200 focus:bg-blue-900 focus:text-white cursor-pointer transition-colors",selectTrigger:"bg-slate-800 border border-blue-700 text-blue-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",selectContent:"bg-slate-900 text-white",buttonPrimary:"bg-blue-600 hover:bg-blue-500 focus:ring-2 focus:ring-blue-400 text-white font-semibold",buttonSecondary:"bg-slate-800 text-blue-300 hover:bg-blue-800 hover:text-white border border-blue-700",title:"text-blue-300",description:"text-blue-400"},T2:{modal:"rounded-2xl bg-gradient-to-br from-yellow-950 via-amber-900 to-orange-950 border border-amber-700 shadow-2xl text-[#f0e4c1]",label:"text-amber-300",input:"bg-[#4a2e08] border border-amber-600 text-[#f0e4c1] placeholder:text-amber-300 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 ",li:"text-amber-100",dropdown:"bg-[#4a2e08] via-amber-900 to-orange-950 border border-amber-700 text-[#f0e4c1] shadow-lg rounded-xl focus:ring-2 px-3 focus:ring-amber-400 focus:border-amber-400",dropdownItem:"px-4 py-2 rounded-md text-amber-100 hover:bg-amber-900 hover:text-amber-200 focus:bg-amber-950 focus:text-white cursor-pointer transition-colors",selectTrigger:"bg-[#4a2e08] border border-amber-600 text-[#f0e4c1] focus:ring-2 focus:ring-amber-400 focus:border-amber-400",selectContent:"bg-[#3e2f0f] text-[#f0e4c1]",buttonPrimary:"bg-amber-700 hover:bg-amber-600 focus:ring-2 focus:ring-amber-500 text-black font-semibold",buttonSecondary:"bg-[#2e1e06] text-amber-300 hover:bg-amber-800 hover:text-white border border-amber-600",title:"text-amber-400",description:"text-amber-400"}};function ey(e){let{open:t,onClose:a,onBlueprintAdded:l}=e,[n,i]=(0,r.useState)("T1"),[o,c]=(0,r.useState)("game"),[u,x]=(0,r.useState)(""),[b,h]=(0,r.useState)(""),[p,g]=(0,r.useState)(""),[j,v]=(0,r.useState)(10),[N,_]=(0,r.useState)(""),[T,M]=(0,r.useState)(""),[O,I]=(0,r.useState)(!1),[P,E]=(0,r.useState)(null),[A,z]=(0,r.useState)(!1),R=eN[n],[L,B]=(0,r.useState)(!1),[D,U]=(0,r.useState)(1),[q,V]=(0,r.useState)(void 0),J="T2"===n&&"game"===o,K=(0,r.useMemo)(()=>{let e=u.trim().split("\n"),t=b.trim().split("\n"),a={},s="",l="",r=!0;function n(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?"Invention Materials / Uncategorized":"Uncategorized",i=!1;for(let u=0;u<e.length;u++){var o,c,d;let m=e[u].trim();if(!m)continue;if(r&&!t){let[e,t]=m.split("	");s=null==e?void 0:e.replace("Blueprint","").trim(),l=null==t?void 0:t.trim(),r=!1;continue}if(/^(Items|Minerals|Components|Planetary materials|Datacores|Optional items)$/i.test(m)){if(n=t?"Invention Materials / ".concat(m):m,"Optional items"===m&&t&&(null==(o=e[u+2])?void 0:o.startsWith("No item selected"))){u+=2;continue}a[n]=[],i=!1;continue}if(/^Item\tRequired\tAvailable\tEst\..*price\ttypeID$/i.test(m)){i=!0;continue}if(!i)continue;let[x,b,h,g]=m.split("	"),f=parseInt(b),j=parseFloat(g);if(x&&!isNaN(f)){let e=t&&p?isNaN(j)?void 0:j/(parseFloat(p)>1?parseFloat(p)/100:parseFloat(p)):isNaN(j)?void 0:j;null!=a[c=n]||(a[c]=[]),a[n].push({name:x.trim(),quantity:f,unitPrice:e})}}}n(e),J&&n(t,!0);let i={};for(let[e,t]of(s&&l&&(i["Blueprint Info"]=[{name:"Name: ".concat(s),quantity:0},{name:"Type ID: ".concat(l),quantity:0}]),p&&J&&(i["Invention Metadata"]=[{name:"Invention Chance: ".concat(p,"%"),quantity:0}]),Object.entries(a)))e in i||(i[e]=t);return i},[u,b,p,J]);async function W(e){e.preventDefault(),I(!0),E(null),z(!1);try{let e=await fetch("/api/blueprints/blueprints",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({blueprint_paste:u,invention_materials:b,sell_price:parseFloat(N)||0,amt_per_run:D||1,material_cost:parseFloat(T)||0,tier:n,invention_chance:p?parseFloat(p):null,runs_per_copy:"T2"===n?j:null})});if(!e.ok){let t=await e.json();throw Error(t.error||"Unknown error")}z(!0),setTimeout(()=>a(),1500)}catch(e){console.error("Error adding blueprint:",e),E(e.message||"Failed to add blueprint")}finally{null==l||l(),console.log("Added blueprint data:",u),I(!1)}}return(0,s.jsx)(f,{open:t,onOpenChange:e=>!e&&a(),children:(0,s.jsx)("div",{className:"w-full overflow-x-hidden",children:(0,s.jsxs)(y,{className:d(eN[n].modal,"max-w-2xl w-full max-h-[90vh] overflow-y-auto px-4"),children:[(0,s.jsxs)(w,{className:"mb-4",children:[(0,s.jsx)(S,{className:eN[n].title+" text-lg font-semibold",children:"Add Blueprint"}),(0,s.jsx)(C,{className:R.description,children:"Paste in your blueprint data from game or ISK/hour"})]}),(0,s.jsxs)("form",{onSubmit:W,className:"space-y-6",children:[(0,s.jsxs)("div",{className:R.label+" flex gap-4",children:[(0,s.jsxs)(F,{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"radio",checked:"game"===o,onChange:()=>c("game")})," From Game"]}),(0,s.jsxs)(F,{className:eN[n].label,children:[(0,s.jsx)("input",{type:"radio",checked:"isk"===o,onChange:()=>c("isk")})," From ISK/Hour"]})]}),"game"===o&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(eb,{value:n,onValueChange:e=>i(e),className:"flex gap-4 ".concat(R.label),children:[(0,s.jsxs)(F,{htmlFor:"T1",className:"flex items-center gap-2 cursor-pointer select-none",children:[(0,s.jsx)(eh,{id:"T1",value:"T1",className:"border-blue-500 data-[state=checked]:bg-blue-400 data-[state=checked]:ring-2 data-[state=checked]:ring-blue-500"}),"T1"]}),(0,s.jsxs)(F,{htmlFor:"T2",className:"flex items-center gap-2 cursor-pointer select-none",children:[(0,s.jsx)(eh,{id:"T2",value:"T2",className:"border-amber-500 data-[state=checked]:bg-amber-400 data-[state=checked]:ring-2 data-[state=checked]:ring-amber-500"}),"T2"]})]}),(0,s.jsx)(eu,{placeholder:"Paste blueprint data from game",value:u,onChange:e=>x(e.target.value),className:"".concat(R.input," placeholder:").concat(R.label," min-h-[120px] resize-y w-full break-words"),style:{wordBreak:"break-word"}}),(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{htmlFor:"blueprintParseAmtPerRun",className:"".concat(R.label," mb-1 block"),children:"Amount per Run"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)(es,{value:L?"custom":String(null!=D?D:1),onValueChange:e=>{"custom"===e?B(!0):(B(!1),U(Number(e)))},children:[(0,s.jsx)(er,{id:"blueprintParseAmtPerRun",className:"".concat(R.selectTrigger," ").concat(R.dropdown," h-10 pl-4 mt-2 scale-110 mx-2 custom-select-trigger"),children:(0,s.jsx)(el,{placeholder:"Choose amount..."})}),(0,s.jsxs)(en,{className:R.selectContent,children:[(0,s.jsx)(ei,{value:"100",children:"100 Units"}),(0,s.jsx)(ei,{value:"1",children:"1 Unit"}),(0,s.jsx)(ei,{value:"custom",children:"Custom…"})]})]}),L&&(0,s.jsx)("input",{type:"number",min:1,value:q,onChange:e=>V(Number(e.target.value)),className:"w-32 px-3 py-1.5 rounded-md bg-slate-900 border border-slate-700 text-blue-100 text-sm mt-2 h-10",placeholder:"Custom amount"})]})]}),J&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eu,{placeholder:"Paste invention materials",value:b,onChange:e=>h(e.target.value),className:"".concat(R.input," placeholder:").concat(R.label)}),(0,s.jsx)(k,{placeholder:"Invention chance % (e.g. 42.5)",value:p,onChange:e=>{let t=e.target.value;""!==t&&isNaN(parseFloat(t))||g(t)},className:"".concat(R.input," placeholder:").concat(R.label)}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"blueprintParseRunsPerCopy",className:R.label,children:"Runs per Invented Copy"}),(0,s.jsx)("div",{className:"mt-2"}),(0,s.jsxs)("select",{id:"blueprintParseRunsPerCopy",name:"blueprintParseRunsPerCopy",value:j,onChange:e=>v(Number(e.target.value)),className:"".concat(R.selectTrigger," ").concat(R.dropdown," h-10 pl-4"),children:[(0,s.jsx)("option",{className:R.dropdownItem,value:10,selected:!0,children:"10 Runs"}),(0,s.jsx)("option",{className:R.dropdownItem,value:1,children:"1 Run"})]})]})]})]}),"isk"===o&&(0,s.jsx)(eu,{placeholder:"Paste ISK/hour format material list here",value:u,onChange:e=>x(e.target.value),className:"".concat(R.input," placeholder:").concat(R.label," min-h-[120px] resize-y")}),Object.keys(K).length>0&&(0,s.jsxs)("div",{className:"".concat(R.input," rounded-lg p-4 text-sm"),children:[(0,s.jsx)("strong",{className:"block mb-2 ".concat(R.title),children:"Parsed Preview:"}),(0,s.jsx)(ej,{className:"h-80 pr-2 px-2 scroll-py-2.5 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent",children:(0,s.jsxs)("div",{className:"w-full space-y-4 break-words",children:[Object.entries(K).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("div",{className:"".concat(R.title," font-semibold mb-1"),children:t}),(0,s.jsxs)("ul",{className:"".concat(R.label," space-y-1"),children:[a.map(e=>{let{name:a,quantity:l,unitPrice:r}=e;return(0,s.jsx)("li",{className:"".concat(R.li," flex justify-between"),children:"Blueprint Info"===t||"Invention Metadata"===t?(0,s.jsx)("span",{className:R.li,children:a}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:R.li,children:a}),(0,s.jsxs)("span",{className:R.li,children:[l," ",void 0!==r?"\xd7 ".concat(r.toLocaleString(void 0,{maximumFractionDigits:2})," ISK"):""]})]})},a)}),"Blueprint Info"!==t&&"Invention Metadata"!==t&&(0,s.jsxs)("li",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:R.description,children:"Total:"}),(0,s.jsxs)("span",{className:R.label,children:[a.reduce((e,t)=>{let{quantity:a,unitPrice:s}=t;return e+a*(null!=s?s:0)},0).toLocaleString(void 0,{maximumFractionDigits:2})," ISK"]})]})]})]},t)}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("strong",{className:"block mb-2 ".concat(R.title),children:"Est. Price:"}),(0,s.jsxs)("span",{className:R.label,children:[Object.values(K).reduce((e,t)=>e+t.reduce((e,t)=>{let{quantity:a,unitPrice:s}=t;return e+a*(null!=s?s:0)},0),0).toLocaleString(void 0,{maximumFractionDigits:2})," ISK"]})]})]})})]}),P&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-red-400 text-sm",children:[(0,s.jsx)(ep.A,{className:"w-4 h-4"}),P]}),A&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[(0,s.jsx)(eg.A,{className:"w-4 h-4"}),"Blueprint added successfully!"]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)(k,{placeholder:"Sell Price (Leave as 0 for auto)",value:N,onChange:e=>_(e.target.value),className:"".concat(R.input," placeholder:").concat(R.label)}),(0,s.jsx)(k,{placeholder:"Make Cost (Leave as 0 for auto)",value:T,onChange:e=>M(e.target.value),className:"".concat(R.input," placeholder:").concat(R.label)})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,s.jsx)(m,{type:"submit",className:eN[n].buttonPrimary,disabled:O,children:O?"Adding...":"Add Blueprint"}),(0,s.jsx)(m,{type:"button",variant:"secondary",className:eN[n].buttonSecondary,onClick:a,children:"Cancel"})]})]})]})})})}let ew=(0,i.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function e_(e){let{className:t,variant:a,...l}=e;return(0,s.jsx)("div",{"data-slot":"alert",role:"alert",className:d(ew({variant:a}),t),...l})}function eS(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-description",className:d("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...a})}let eC=async(e,t)=>{t(!0);try{console.log("MSW ready. Requesting /api/blueprints/blueprints. Fetching blueprints...");let t=await fetch("/api/blueprints/blueprints");if(!t.ok)throw Error("Failed to fetch blueprints");let a=await t.json();return e(a),console.log("Fetched blueprints:",a),a}catch(e){return console.error("Fetch error:",e),l.oR.error("Failed to load blueprints"),[]}finally{t(!1)}};function ek(){let[e,t]=(0,r.useState)(!1),[a,n]=(0,r.useState)(null),[i,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),[u,x]=(0,r.useState)(!1),[b,h]=(0,r.useState)([]),[p,g]=(0,r.useState)(null),[f,j]=(0,r.useState)("");async function v(e){try{let a=await fetch("/api/blueprints/blueprint/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw console.error("Failed to update blueprint"+a.statusText+a.body),Error("Failed to update blueprint");l.oR.success("Blueprint updated");let s=(await eC(h,x)).find(t=>t.id===e.id);n(null!=s?s:null),t(!1),n(null)}catch(e){console.error("Error updating blueprint:",e)}}async function N(e){try{let t=await fetch("/api/blueprints/blueprints",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to add blueprint");let a=await t.json();a.message?l.oR.success(a.message):l.oR.error(a.error)}catch(e){console.error(e),alert("Failed to update blueprint")}}(0,r.useEffect)(()=>{console.log("Blueprints state changed:",b)},[b]);let y=async()=>{j("Updating blueprint prices..."),document.title="Updating blueprint prices...";try{let e=await fetch("/api/blueprints/update_prices",{method:"POST",headers:{"Content-Type":"application/json"}});if(e.ok){let t=await e.json();j(t.message||"Prices updated successfully!"),eC(h,x),document.title="Eve Manufacturing Optimizer"}else{let t=await e.json();j(t.error||"Failed to update prices.")}}catch(e){j("Error updating prices: "+e)}};return(0,r.useEffect)(()=>{eC(h,x)},[]),(0,s.jsxs)(E,{className:"rounded-2xl bg-gradient-to-br from-slate-900 via-slate-950 to-blue-950 border-blue-800 shadow-2xl w-full ",children:[(0,s.jsx)(A,{className:"px-6 pb-2",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,s.jsx)(z,{className:"text-2xl text-blue-100",children:"Blueprints Overview"}),(0,s.jsx)(R,{className:"text-blue-400",children:"View and Manage Blueprints"})]}),(0,s.jsx)(m,{onClick:()=>o(!0),className:"bg-gradient-to-r from-blue-700 via-blue-900 to-blue-800 text-white hover:from-blue-800 hover:to-blue-900 relative top-[10px] left-[-35px] scale-125",children:"+ Add Blueprints"})]})}),(0,s.jsx)(ee,{onEdit:function(e,a){n(e),d(a),t(!0)},blueprints:b,onSetBlueprints:h,loading:u,fetchBlueprints:()=>eC(h,x)}),(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2 px-6 pt-4",children:[(0,s.jsx)(m,{id:"update-blueprints-btn",className:"w-fit text-sm bg-blue-700 hover:bg-blue-800 mx-auto",onClick:y,children:"Update All Blueprint Prices (Cost and Sell)"}),f&&(0,s.jsx)(e_,{className:"   w-full   flex   justify-center   items-center   text-blue-300   font-semibold   bg-blue-950/60   border border-blue-700   rounded-xl   py-2   mt-2   shadow-lg   animate-in fade-in   text-center   ",children:(0,s.jsx)(eS,{className:"w-full text-center justify-center text-blue-300",children:f})})]}),(0,s.jsx)(ed,{open:e,blueprint:a,tier:c,onClose:()=>t(!1),onSave:v}),(0,s.jsx)(ey,{open:i,onClose:()=>o(!1),onSubmit:N,onBlueprintAdded:()=>{console.log("\uD83D\uDD01 Running fetchBlueprints after add"),eC(h,x)}})]})}var eT=a(1154);function eF(e){let{materials:t,loading:a,onEdit:l,onDelete:r}=e,n={};for(let e of t){let t=e.category||"Other";n[t]||(n[t]=[]),n[t].push(e)}return(0,s.jsx)("div",{className:"space-y-6",children:a?(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-blue-300 animate-pulse",children:[(0,s.jsx)(eT.A,{className:"w-5 h-5 animate-spin"}),(0,s.jsx)("span",{children:"Loading materials..."})]}):0===Object.keys(n).length?(0,s.jsx)("p",{className:"text-sm text-blue-300 italic",children:"No materials found."}):(0,s.jsx)(U,{type:"multiple",className:"w-full space-y-4",children:Object.entries(n).sort((e,t)=>{let[a]=e,[s]=t;return a.localeCompare(s)}).map(e=>{let[t,a]=e;return(0,s.jsxs)(q,{value:t,className:"rounded-2xl border border-blue-800 bg-gradient-to-br from-blue-950 via-slate-900 to-slate-950 shadow-lg",children:[(0,s.jsx)(V,{className:"px-4 py-3 text-left text-lg font-semibold text-blue-200 hover:no-underline hover:text-blue-300",children:t}),(0,s.jsx)(J,{className:"px-4 pb-4 space-y-3",children:a.map(e=>(0,s.jsxs)("div",{className:"flex justify-between items-center bg-slate-900/70 hover:bg-blue-900/60 border border-blue-800 rounded-xl px-4 py-2 shadow-sm transition-all",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-semibold text-blue-100",children:e.name}),(0,s.jsxs)("span",{className:"text-sm text-blue-300",children:[e.quantity.toLocaleString()," units"]})]}),(0,s.jsxs)("div",{className:"space-x-2",children:[(0,s.jsx)(m,{size:"sm",className:"bg-blue-700 hover:bg-blue-600 shadow-md hover:shadow-blue-500/30 text-white",onClick:()=>l(e),children:"Edit"}),(0,s.jsx)($,{onDelete:()=>r(e.id),children:"Delete"})]})]},e.id))})]},t)})})})}function eM(e){let{material:t,open:a,onClose:l,onSave:n}=e,[i,o]=(0,r.useState)(0),[c,d]=(0,r.useState)(),[u,x]=(0,r.useState)("Other"),[b,h]=(0,r.useState)("");async function p(e){e.preventDefault(),t&&n({...t,quantity:i,type_id:c,category:"Other"===u?b:u})}return(0,r.useEffect)(()=>{if(t){var e;o(t.quantity),d(null!=(e=t.type_id)?e:void 0),x(t.category||"Other"),h("")}},[t]),(0,s.jsx)(f,{open:a,onOpenChange:l,children:(0,s.jsxs)(y,{className:"rounded-2xl bg-gradient-to-br from-slate-900 via-slate-950 to-blue-950 border-blue-800 shadow-2xl w-full",children:[(0,s.jsx)(w,{children:(0,s.jsxs)(S,{className:"text-blue-300",children:["Edit Material",t?": ".concat(t.name):""]})}),(0,s.jsxs)("form",{onSubmit:p,className:"space-y-4",children:[(0,s.jsx)(k,{type:"number",placeholder:"Quantity",value:i,onChange:e=>o(Number(e.target.value)),required:!0,className:"bg-slate-900 border border-slate-700 text-blue-100"}),(0,s.jsx)(k,{type:"number",placeholder:"Type ID (optional)",value:null!=c?c:"",onChange:e=>d(Number(e.target.value)),className:"bg-slate-900 border border-slate-700 text-blue-100"}),(0,s.jsxs)(es,{value:u,onValueChange:x,children:[(0,s.jsx)(er,{className:"bg-slate-900 border border-slate-700 text-blue-100",children:(0,s.jsx)(el,{placeholder:"Select category"})}),(0,s.jsxs)(en,{className:"bg-slate-800 text-blue-100",children:[(0,s.jsx)(ei,{value:"Minerals",children:"Minerals"}),(0,s.jsx)(ei,{value:"Items",children:"Items"}),(0,s.jsx)(ei,{value:"Components",children:"Components"}),(0,s.jsx)(ei,{value:"Invention Materials",children:"Invention Materials"}),(0,s.jsx)(ei,{value:"Reaction Materials",children:"Reaction Materials"}),(0,s.jsx)(ei,{value:"Planetary Materials",children:"Planetary Materials"}),(0,s.jsx)(ei,{value:"Other",children:"Other"})]})]}),"Other"===u&&(0,s.jsx)(k,{type:"text",placeholder:"Enter custom category",value:b,onChange:e=>h(e.target.value),className:"bg-slate-900 border border-slate-700 text-blue-100"}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,s.jsx)(m,{type:"submit",className:"bg-blue-700 hover:bg-blue-800 text-white",children:"Save"}),(0,s.jsx)(m,{type:"button",variant:"secondary",className:"bg-slate-700 text-blue-200",onClick:l,children:"Cancel"})]})]})]})})}function eO(e){let{open:t,onClose:a,onSubmit:l}=e,[n,i]=(0,r.useState)(""),[o,c]=(0,r.useState)("add"),[d,u]=(0,r.useState)(!1),[x,b]=(0,r.useState)(null),[h,p]=(0,r.useState)(!1),g=(0,r.useMemo)(()=>n.trim().split("\n").map(e=>{let[t,a]=e.split("	"),s=parseInt(a);return t&&!isNaN(s)?{name:t.trim(),quantity:s}:null}).filter(e=>null!==e),[n]);async function j(e){if(e.preventDefault(),b(null),p(!1),!g.length)return;let t={};g.forEach(e=>{let{name:a,quantity:s}=e;t[a]=s}),u(!0);try{let e=await fetch("/api/materials/update_materials",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({materials:t,updateType:o})});if(!e.ok){let t=await e.json();throw Error(t.error||"Unknown error")}i(""),c("add"),p(!0),l({materialsText:n,updateType:o}),setTimeout(()=>a(),1500)}catch(e){console.error("Error submitting materials:",e),b(e.message||"Failed to submit materials")}finally{u(!1)}}return(0,s.jsx)(f,{open:t,onOpenChange:e=>!e&&a(),children:(0,s.jsxs)(y,{className:"rounded-2xl bg-gradient-to-br from-slate-900 via-slate-950 to-blue-950 border-blue-800 shadow-2xl w-full max-w-lg",children:[(0,s.jsx)(w,{children:(0,s.jsx)(S,{className:"text-blue-300 text-lg font-semibold",children:"Add Available Materials From Game (Copy/Paste)"})}),(0,s.jsxs)("form",{onSubmit:j,className:"space-y-6",children:[(0,s.jsx)(eu,{placeholder:"Paste available materials here",required:!0,value:n,onChange:e=>i(e.target.value),className:"bg-slate-900 border border-slate-700 text-blue-100 placeholder:text-blue-400 resize-y min-h-[120px]"}),(0,s.jsxs)(eb,{defaultValue:"add",value:o,onValueChange:e=>c(e),className:"flex flex-col gap-4 text-blue-200",children:[(0,s.jsxs)(F,{htmlFor:"addToMaterials",className:"flex items-center gap-2 cursor-pointer select-none",children:[(0,s.jsx)(eh,{id:"addToMaterials",value:"add",className:"border-blue-500 data-[state=checked]:bg-blue-400 data-[state=checked]:border-blue-200"}),"Add to existing materials (Replaces materials with the same name)"]}),(0,s.jsxs)(F,{htmlFor:"replaceMaterials",className:"flex items-center gap-2 cursor-pointer select-none",children:[(0,s.jsx)(eh,{id:"replaceMaterials",value:"replace",className:"border-blue-500 data-[state=checked]:bg-blue-400 data-[state=checked]:border-blue-200"}),"Replace ALL materials (Deletes all existing materials)"]})]}),g.length>0&&(0,s.jsxs)("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-4 text-sm text-blue-200",children:[(0,s.jsx)("strong",{className:"block mb-2 text-blue-400",children:"Parsed Preview:"}),(0,s.jsx)(ej,{className:"h-40 pr-2",children:(0,s.jsx)("ul",{className:"space-y-1",children:g.map(e=>{let{name:t,quantity:a}=e;return(0,s.jsxs)("li",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)("span",{className:"text-blue-300",children:a})]},t)})})})]}),x&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-red-400 text-sm",children:[(0,s.jsx)(ep.A,{className:"w-4 h-4"}),x]}),h&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[(0,s.jsx)(eg.A,{className:"w-4 h-4"}),"Materials updated successfully!"]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2 pt-2",children:[(0,s.jsx)(m,{type:"submit",className:"bg-blue-700 hover:bg-blue-800 text-white",disabled:d||!g.length,children:d?"Updating...":"Update Available Materials"}),(0,s.jsx)(m,{type:"button",variant:"secondary",className:"bg-slate-700 text-blue-200 hover:bg-slate-600",onClick:a,disabled:d,children:"Cancel"})]})]})]})})}function eI(){let[e,t]=(0,r.useState)(!1),[a,l]=(0,r.useState)(null),[n,i]=(0,r.useState)(!1),[o,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)([]);function x(){l(null),t(!1)}async function b(e){try{await fetch("/api/materials/material/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),u(t=>t.map(t=>t.id===e.id?e:t)),x()}catch(e){console.error("Error updating material:",e)}}async function h(e){let t=e.materialsText.trim().split("\n").map(e=>{let[t,a]=e.split("	"),s=parseInt(a);return t&&!isNaN(s)?{name:t.trim(),quantity:s}:null}).filter(e=>null!==e),a={};t.forEach(e=>{let{name:t,quantity:s}=e;a[t]=s});try{if(!(await fetch("/api/materials/update_materials",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({materials:a,updateType:e.updateType})})).ok)throw Error("Failed to update materials");await g()}catch(e){console.error("Failed to add materials:",e),alert("Failed to update materials")}}async function p(e){try{(await fetch("/api/materials/material/".concat(e),{method:"DELETE"})).ok?(u(t=>t.filter(t=>t.id!==e)),console.log("Material deleted successfully.")):console.error("Failed to delete material.")}catch(e){console.error("Error deleting material:",e)}}let g=async()=>{c(!0);try{let e=await fetch("/api/materials/materials");if(!e.ok)throw Error("Failed to fetch materials");let t=await e.json();u(t),console.log("Fetched materials:",t)}catch(e){console.error("Fetch error:",e)}finally{c(!1)}};return(0,r.useEffect)(()=>{console.log("Materials state changed:",d)},[d]),(0,r.useEffect)(()=>{console.log("Fetching materials..."),g()},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(E,{className:"h-full rounded-2xl bg-gradient-to-br from-slate-900 via-slate-950 to-blue-950 border-blue-800 shadow-2xl w-full",children:[(0,s.jsx)(A,{className:"px-6 pb-2",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,s.jsx)(z,{className:"text-2xl text-blue-100",children:"Available Materials"}),(0,s.jsx)(R,{className:"text-blue-400",children:"View and Manage Materials"})]}),(0,s.jsx)(m,{onClick:()=>i(!0),className:"bg-gradient-to-r from-blue-700 via-blue-900 to-blue-800 text-white hover:from-blue-800 hover:to-blue-900 relative top-[5px] left-[-30px] scale-125",children:"+ Add Materials"})]})}),(0,s.jsx)(L,{className:"space-y-4",children:(0,s.jsx)(U,{type:"single",collapsible:!0,children:(0,s.jsxs)(B.As,{value:"materials",className:"border-none bg-slate-900/60 rounded-xl overflow-hidden",children:[(0,s.jsx)(V,{className:"text-blue-200 text-lg font-bold tracking-wide rounded-xl px-4 py-3 bg-blue-900/80 hover:bg-blue-800/80 hover:no-underline shadow transition-all",children:"View Materials Table (Split by Category)"}),(0,s.jsxs)(J,{className:"bg-slate-900/80 px-2 pb-4 pt-2 rounded-b-xl space-y-4",children:[(0,s.jsx)("p",{id:"update-status",className:"text-sm text-gray-400 text-center"}),(0,s.jsx)(eF,{materials:d,loading:o,onEdit:function(e){l(e),t(!0)},onDelete:p}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(m,{id:"update-materials-btn",className:"text-sm bg-blue-700 hover:bg-blue-800",onClick:async()=>{let e=document.getElementById("update-status");e&&(e.textContent="Updating material info...",document.title="Updating material info...");try{let t=await fetch("/api/materials/update_material_info",{method:"POST",headers:{"Content-Type":"application/json"}});if(t.ok){let a=await t.json();e&&(e.textContent=a.message||"Material info updated successfully!"),g(),document.title="EVE Manufacturing Optimizer"}else{let a=await t.json();e&&(e.textContent=a.ERROR||"Failed to update material info.")}}catch(t){e&&(e.textContent="Error updating material info: "+t.message)}},children:"Update Material Info (TypeID and Category)"})})]})]})})})]}),(0,s.jsx)(eO,{open:n,onClose:()=>i(!1),onSubmit:h}),a&&(0,s.jsx)(eM,{material:a,open:e,onClose:x,onSave:b})]})}var eP=a(3568);function eE(e){let{data:t}=e,a=t.true_profit_inventory/t.total_profit*100,l=t.true_profit_jita/t.total_profit*100;function r(e){return e<15?"text-red-400":e<25?"text-orange-400":e<35?"text-lime-400 font-semibold shadow-green-400/30 drop-shadow-sm":e<50?'text-emerald-400 font-semibold shadow-lime-400/40 drop-shadow-md after:content-["⭐️"]':e<70?'text-green-400 font-bold drop-shadow-[0_0_5px_#34d399] after:content-["\uD83C\uDF1F"]':'text-fuchsia-400 font-extrabold drop-shadow-[0_0_6px_#e879f9] after:content-["✨"]'}return(0,s.jsxs)("div",{className:"rounded-2xl bg-gradient-to-br from-blue-950 via-slate-900 to-slate-950 p-6 shadow-xl border border-blue-800 w-full",children:[(0,s.jsx)("h3",{className:"text-2xl text-blue-200 font-bold mb-4",children:"Optimization Summary"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-5 gap-6 text-center text-blue-100",children:[(0,s.jsx)(eA,{title:"Total Sell Value",value:t.total_profit,color:"text-green-400"}),(0,s.jsx)(eA,{title:"True Profit (Jita)",value:t.true_profit_jita,color:"text-blue-400"}),(0,s.jsx)(eA,{title:"True Profit % (Jita)",value:l,isPercent:!0,className:r(l)}),(0,s.jsx)(eA,{title:"True Profit (Inventory)",value:t.true_profit_inventory,color:"text-yellow-400"}),(0,s.jsx)(eA,{title:"True Profit % (Inventory)",value:a,isPercent:!0,className:r(a)})]}),(0,s.jsxs)("div",{className:"mt-4 text-xs text-blue-400 text-center",children:[(0,s.jsxs)("span",{className:"block",children:[(0,s.jsx)("span",{className:"font-bold",children:"True Profit (Jita):"})," Profit if you bought all materials at Jita sell price."]}),(0,s.jsxs)("span",{className:"block",children:[(0,s.jsx)("span",{className:"font-bold",children:"True Profit (Inventory):"})," Profit accounting for your current inventory (only buying what you lack)."]})]})]})}function eA(e){let{title:t,value:a,color:l,isPercent:n,className:i}=e,[o,c]=(0,r.useState)(!1);return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center bg-slate-800 rounded-xl p-4 shadow-md border border-blue-800 hover:shadow-blue-500/40 hover:border-blue-500 transition duration-300 cursor-pointer",onClick:()=>{c(e=>!e)},title:"Click to toggle value format",children:[(0,s.jsx)("span",{className:"text-sm text-blue-300",children:t}),(0,s.jsx)("span",{className:"text-xl font-semibold transition-all duration-200 ".concat(null!=l?l:""," ").concat(null!=i?i:""),children:n?"".concat(a.toFixed(2),"%"):o?Z(a):"".concat(a.toLocaleString()," ISK")})]})}function ez(e){let{data:t}=e;if(!t||0===Object.keys(t).length)return null;let a=Object.entries(t).sort((e,t)=>e[0].localeCompare(t[0]));return(0,s.jsxs)("div",{className:"rounded-2xl bg-gradient-to-br from-blue-950 via-slate-900 to-slate-950 p-4 shadow-xl border border-blue-800 w-full",children:[(0,s.jsx)("h3",{className:"text-xl text-blue-300 font-semibold",children:"Required Component Production"}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm text-left text-blue-100 rounded-lg overflow-hidden border border-blue-800",children:[(0,s.jsx)("thead",{className:"bg-blue-800 text-blue-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2",children:"Component"}),(0,s.jsx)("th",{className:"px-4 py-2",children:"Quantity Needed"})]})}),(0,s.jsx)("tbody",{children:a.map(e=>{let[t,a]=e;return(0,s.jsxs)("tr",{className:"border-t border-blue-800",children:[(0,s.jsx)("td",{className:"px-4 py-1",children:t}),(0,s.jsx)("td",{className:"px-4 py-1",children:a.toLocaleString()})]},t)})})]})})]})}function eR(e){let{data:t}=e,a=Object.entries(t).filter(e=>{let[t,a]=e;return a>0}).sort((e,t)=>e[0].localeCompare(t[0]));return 0===a.length?null:(0,s.jsxs)("div",{className:"rounded-2xl bg-gradient-to-br from-blue-950 via-slate-900 to-slate-950 p-4 shadow-xl border border-blue-800 w-full",children:[(0,s.jsx)("h3",{className:"text-xl text-blue-300 font-semibold",children:"Production Plan"}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm text-left text-blue-100 rounded-lg overflow-hidden border border-blue-800",children:[(0,s.jsx)("thead",{className:"bg-blue-800 text-blue-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2",children:"Blueprint"}),(0,s.jsx)("th",{className:"px-4 py-2",children:"Quantity"})]})}),(0,s.jsx)("tbody",{children:a.map(e=>{let[t,a]=e;return(0,s.jsxs)("tr",{className:"border-t border-blue-800",children:[(0,s.jsx)("td",{className:"px-4 py-1",children:t}),(0,s.jsx)("td",{className:"px-4 py-1",children:a.toLocaleString()})]},t)})})]})})]})}var eL=a(3052);let eB=["Tritanium","Pyerite","Mexallon","Isogen","Nocxium","Zydrine","Megacyte","Morphite"],eD=["Minerals","Components","Items","Invention Materials","Reaction Materials","Salvaged Materials","Planetary Materials","Fuel","Other"];function eU(e){let{usage:t,savings:a={},expected_invention:l,invention_cost:n}=e,i={},[o,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1);for(let e in t){var x,b;let a=t[e],s=null!=(b=null==(x=a.category)?void 0:x.trim())?b:"Other";eB.includes(e)&&(s="Minerals"),eD.includes(s)||(s="Other"),i[s]||(i[s]={}),i[s][e]=a}return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h3",{className:"text-2xl text-blue-300 font-semibold",children:"Material Usage by Category"}),(0,s.jsx)("p",{className:"text-lg text-blue-300 font-normal mb-2",children:'See "To be built" and "Inventory Savings" for more details on negative materials.'})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:eD.map(e=>{let t=i[e];if(!t)return null;let a=Object.values(t).filter(e=>e.used>0).length,l=Object.keys(t).length;return(0,s.jsxs)("div",{className:d("rounded-xl bg-gradient-to-br from-slate-900 via-slate-950 to-blue-950 border border-blue-800 shadow-md transition-all",o?"ring-2 ring-blue-600 shadow-xl":"hover:ring-1 hover:ring-blue-600"),children:[(0,s.jsxs)("div",{className:"cursor-pointer flex justify-between items-center p-4",onClick:()=>c(!o),children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-lg text-blue-200 font-bold",children:e}),(0,s.jsxs)("p",{className:"text-blue-400 text-sm",children:[l," total kind(s) of ",e," — ",a," used"]})]}),(0,s.jsx)("div",{className:"text-blue-400",children:o?(0,s.jsx)(D.A,{}):(0,s.jsx)(eL.A,{})})]}),o&&(0,s.jsxs)("div",{className:"px-4 pb-4 space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-xs text-blue-300 font-semibold border-b border-blue-800 pb-1",children:[(0,s.jsx)("div",{className:"w-1/3",children:"Material"}),(0,s.jsx)("div",{className:"w-1/4 text-right",children:"Used"}),(0,s.jsx)("div",{className:"w-1/4 text-right",children:"Remaining"}),(0,s.jsx)("div",{className:"w-1/5 text-right",children:"Used %"})]}),Object.entries(t).sort((e,t)=>e[0].localeCompare(t[0])).map(e=>{let[t,a]=e,l=a.used+a.remaining,r=l>0?a.used/l*100:0,n=r>=200?"text-red-900":r>=180?"text-red-800":r>=160?"text-red-700":r>=140?"text-red-600":r>=120?"text-red-500":r>=100?"text-red-400":r>=90?"text-red-300":r>=70?"text-orange-400":r>=50?"text-yellow-500":r>=30?"text-green-300":"text-green-400",i=Math.min(r,100);return(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm text-blue-100",children:[(0,s.jsx)("div",{className:"w-1/3 truncate",children:t}),(0,s.jsx)("div",{className:"w-1/4 text-rose-400 text-right",children:a.used.toLocaleString()}),(0,s.jsx)("div",{className:d("w-1/4 text-right",n),children:a.remaining.toLocaleString()}),(0,s.jsxs)("div",{className:"w-1/5 text-right ".concat(n),children:[r.toFixed(1),"%"]})]}),(0,s.jsx)("div",{className:"h-1 bg-slate-800 rounded overflow-hidden",children:(0,s.jsx)("div",{className:d("h-full transition-all duration-300 ease-in-out",r>=200?"bg-red-900":r>=180?"bg-red-800":r>=160?"bg-red-700":r>=140?"bg-red-600":r>=120?"bg-red-500":r>=100?"bg-red-400":r>=90?"bg-red-300":r>=70?"bg-orange-400":r>=50?"bg-yellow-500":r>=30?"bg-green-300":"bg-green-400"),style:{width:"".concat(i,"%")}})})]},t)})]})]},e)})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mt-6",children:[" ",Object.entries(t).some(e=>{let[t,a]=e;return"Items"===a.category&&a.remaining<0})&&(0,s.jsxs)("div",{className:"rounded-xl bg-gradient-to-br from-yellow-800/30 to-yellow-900/30 border border-yellow-600 shadow-inner",children:[(0,s.jsxs)("div",{className:"cursor-pointer flex justify-between items-center p-4",onClick:()=>m(!u),children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("h4",{className:"text-lg text-yellow-300 font-semibold pb-2.5",children:"To Be Built"}),(0,s.jsx)("h3",{className:"text-yellow-300 font-semibold mt-2 text-sm",children:"Shortfall from Items"})]}),(0,s.jsx)("div",{className:"text-yellow-300",children:u?(0,s.jsx)(D.A,{}):(0,s.jsx)(eL.A,{})})]}),u&&(0,s.jsxs)("div",{className:"px-4 pb-4",children:[(0,s.jsxs)("div",{className:"flex justify-between text-xs text-yellow-200 font-semibold border-b border-yellow-600 pb-1",children:[(0,s.jsx)("div",{className:"w-2/3",children:"Material"}),(0,s.jsx)("div",{className:"w-1/3 text-right",children:"Amount"})]}),(0,s.jsx)("div",{className:"mt-2 space-y-1",children:Object.entries(t).filter(e=>{let[t,a]=e;return"Items"===a.category&&a.remaining<0}).sort((e,t)=>{let[a]=e,[s]=t;return a.localeCompare(s)}).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"flex justify-between text-sm text-yellow-100",children:[(0,s.jsx)("div",{className:"w-2/3 truncate",children:t}),(0,s.jsx)("div",{className:"w-1/3 text-right text-yellow-400",children:Math.abs(a.remaining).toLocaleString()})]},t)})})]})]}),(0,s.jsxs)("div",{className:"rounded-xl bg-gradient-to-br from-purple-800/30 to-purple-950/30 border border-purple-700 shadow-inner relative pb-10 ",children:[(0,s.jsxs)("div",{className:"cursor-pointer flex justify-between items-center p-4",onClick:()=>m(!u),children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("h4",{className:"text-lg text-purple-300 font-semibold",children:"Expected Invention Use"}),(0,s.jsx)("h4",{className:"text-sm text-purple-300 font-semibold",children:"Materials needed for planned T2 production"})]}),(0,s.jsx)("div",{className:"text-purple-300",children:u?(0,s.jsx)(D.A,{}):(0,s.jsx)(eL.A,{})})]}),u&&l&&(0,s.jsxs)("div",{className:"px-4 pb-4",children:[(0,s.jsxs)("div",{className:"flex justify-between text-xs text-purple-200 font-semibold border-b border-purple-600 pb-1",children:[(0,s.jsx)("div",{className:"w-2/3",children:"Material"}),(0,s.jsx)("div",{className:"w-1/3 text-right",children:"Amount Needed"})]}),(0,s.jsx)("div",{className:"mt-2 space-y-1",children:Object.entries(l).sort((e,t)=>{let[a]=e,[s]=t;return a.localeCompare(s)}).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"flex justify-between text-sm text-purple-100",children:[(0,s.jsx)("div",{className:"w-2/3 truncate",children:t}),(0,s.jsx)("div",{className:"w-1/3 text-right text-purple-400",children:a.toLocaleString()})]},t)})})]}),void 0!==n&&(0,s.jsx)("div",{className:"absolute bottom-0 p-4 bg-purple-800/20 border-t border-purple-700 text-sm text-purple-100 w-full mt-10",children:(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("div",{className:"w-2/3",children:"Total (Expected) Invention Cost:"}),(0,s.jsx)("div",{className:"w-1/3 text-right text-purple-400",children:n.toLocaleString()})]})})]}),a&&Object.keys(a).length>0&&(0,s.jsxs)("div",{className:"rounded-xl bg-gradient-to-br from-emerald-800/30 to-emerald-950/30 border border-emerald-700 shadow-inner",children:[(0,s.jsxs)("div",{className:"cursor-pointer flex justify-between items-center p-4",onClick:()=>m(!u),children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("h4",{className:"text-lg text-emerald-300 font-semibold pb-2.5",children:"Inventory Savings"}),(0,s.jsx)("h4",{className:"text-sm text-emerald-300 font-semibold",children:"Items (mats with blueprints) used directly from your inventory"})]}),(0,s.jsx)("div",{className:"text-emerald-300",children:u?(0,s.jsx)(D.A,{}):(0,s.jsx)(eL.A,{})})]}),u&&(0,s.jsx)("div",{className:"px-4 pb-4",children:Object.entries(Object.entries(a).reduce((e,t)=>{let[a,{amount:s,category:l="Other"}]=t;return e[l]||(e[l]={}),e[l][a]=s,e},{})).sort((e,t)=>{let[a]=e,[s]=t;return a.localeCompare(s)}).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h5",{className:"text-emerald-200 font-medium mb-1",children:t}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-emerald-300 font-semibold border-b border-emerald-600 pb-1",children:[(0,s.jsx)("div",{className:"w-2/3",children:"Material"}),(0,s.jsx)("div",{className:"w-1/3 text-right",children:"Saved"})]}),(0,s.jsx)("div",{className:"mt-1 space-y-1",children:Object.entries(a).sort((e,t)=>{let[a]=e,[s]=t;return a.localeCompare(s)}).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"flex justify-between text-sm text-emerald-100",children:[(0,s.jsx)("div",{className:"w-2/3 truncate",children:t}),(0,s.jsx)("div",{className:"w-1/3 text-right text-emerald-400",children:a.toLocaleString()})]},t)})})]},t)})})]})]})]})}function eq(e){let{materialUsage:t}=e,a=Object.entries(t).map(e=>{let[t,a]=e,s=a.used+a.remaining;return{name:t,percent:s>0?a.used/s*100:0}}).filter(e=>e.percent>90).sort((e,t)=>t.percent-e.percent);return 0===a.length?null:(0,s.jsxs)("div",{className:"rounded-2xl bg-gradient-to-br from-blue-950 via-slate-900 to-slate-950 p-6 shadow-xl border border-blue-800 w-full",children:[(0,s.jsx)("h3",{className:"text-xl text-blue-300 font-semibold mb-4",children:"Bottleneck Materials"}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:a.map(e=>{let{name:t,percent:a}=e;return(0,s.jsxs)("div",{className:"bg-slate-900/80 border border-blue-800 rounded-xl p-4 shadow hover:shadow-blue-700 transition-all duration-300",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,s.jsx)("span",{className:"text-blue-100 font-medium",children:t}),(0,s.jsxs)("span",{className:"text-xs font-bold px-2 py-1 rounded-full ".concat(a>=200?"bg-red-900 text-red-100":a>=180?"bg-red-800 text-red-100":a>=160?"bg-red-700 text-red-50":a>=140?"bg-red-600 text-red-50":a>=120?"bg-red-500 text-red-50":a>=100?"bg-red-400 text-red-100":a>=95?"bg-red-300 text-red-900":a>=90?"bg-yellow-400 text-yellow-900":a>=70?"bg-orange-400 text-orange-900":a>=50?"bg-yellow-500 text-yellow-900":a>=30?"bg-green-300 text-green-900":"bg-green-400 text-green-900"),children:[a.toFixed(1),"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-slate-800 rounded-full h-2.5 overflow-hidden",children:(0,s.jsx)("div",{className:"h-full transition-all duration-300 ease-in-out ".concat(a>=200?"bg-red-900":a>=180?"bg-red-800":a>=160?"bg-red-700":a>=140?"bg-red-600":a>=120?"bg-red-500":a>=100?"bg-red-400":a>=95?"bg-red-300":a>=90?"bg-yellow-400":a>=70?"bg-orange-400":a>=50?"bg-yellow-500":a>=30?"bg-green-300":"bg-green-400"),style:{width:"".concat(a,"%")},title:"".concat(a.toFixed(2),"% used")})})]},t)})})]})}function eV(){let[e,t]=(0,r.useState)(null),[a,l]=(0,r.useState)(!1),n=async()=>{l(!0);try{let e=await fetch("/api/blueprints/optimize");if(!e.ok)throw Error("Failed to optimize");let a=await e.json();t(a),eP.Ay.success("Optimization complete!")}catch(e){console.error("Optimization failed:",e),eP.Ay.error("Failed to optimize: "+e)}finally{l(!1)}},i=null!==e?{total_profit:e.total_profit,true_profit_jita:e.true_profit_jita,true_profit_inventory:e.true_profit_inventory,inventory_savings:e.inventory_savings,expected_invention_materials_used:e.expected_invention_materials_used,invention_cost:e.invention_cost}:null;return(0,s.jsxs)(E,{className:"rounded-2xl bg-gradient-to-br from-slate-900 via-slate-950 to-blue-950 border-blue-800 shadow-2xl w-full p-6",children:[(0,s.jsx)(A,{children:(0,s.jsx)(z,{className:"text-2xl text-blue-100 mb-2",children:"Optimize Production"})}),(0,s.jsxs)(L,{className:"flex flex-col items-center space-y-6",children:[(0,s.jsx)(m,{onClick:n,disabled:a,className:"bg-blue-900 hover:bg-blue-700 text-white font-bold text-lg py-4 px-6 rounded-lg shadow-lg shadow-blue-500/50 transition duration-300 ease-in-out hover:scale-110 hover:shadow-xl",children:a?"Optimizing...":"OPTIMIZE PRODUCTION"}),e&&(0,s.jsxs)("div",{className:"w-full space-y-6",children:[i&&(0,s.jsx)(eE,{data:i}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsx)(ez,{data:e.dependencies_needed}),(0,s.jsx)(eR,{data:e.what_to_produce})]}),(0,s.jsx)(eU,{usage:e.material_usage,savings:e.inventory_savings,expected_invention:e.expected_invention_materials_used,invention_cost:e.invention_cost}),(0,s.jsx)(eq,{materialUsage:e.material_usage})]})]})]})}function eJ(){let[e,t]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{b.then(()=>{console.log("MSW is fully ready, now rendering app"),t(!0)})},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.l$,{position:"top-right",theme:"light",toastOptions:{className:"bg-blue-100 text-blue-900 border border-blue-300 shadow-lg",style:{backgroundColor:"#dbeafe",color:"#1e3a8a",borderColor:"#93c5fd"}}}),(0,s.jsx)(h,{}),(0,s.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4 px-8 py-10 max-w-7xl mx-auto items-stretch",children:[(0,s.jsx)("div",{className:"h-full",children:(0,s.jsx)(K,{})}),(0,s.jsx)("div",{className:"h-full",children:(0,s.jsx)(eI,{})})]}),(0,s.jsx)("div",{className:"px-8 max-w-7xl mx-auto pb-10",children:(0,s.jsx)(ek,{})}),(0,s.jsx)("div",{className:"px-8 max-w-7xl mx-auto pb-10",children:(0,s.jsx)(eV,{})})]})}},3396:(e,t,a)=>{Promise.resolve().then(a.bind(a,2522))}},e=>{var t=t=>e(e.s=t);e.O(0,[888,441,684,358],()=>t(3396)),_N_E=e.O()}]);